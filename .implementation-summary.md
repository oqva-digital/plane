# Implementation Summary: Bulk Actions for Project Pages

## Changes Made

### Backend API (Python/Django)

1. **apps/api/plane/app/views/page/base.py**
   - Added `BulkArchivePagesEndpoint` class for bulk archiving pages
   - Added `BulkDeletePagesEndpoint` class for bulk deleting archived pages
   - Both endpoints follow the same permission model as individual operations
   - Archive: Requires ADMIN/MEMBER role OR page ownership
   - Delete: Requires ADMIN role OR page ownership, and pages must be archived first

2. **apps/api/plane/app/urls/page.py**
   - Added route: `POST /bulk-archive-pages/` → BulkArchivePagesEndpoint
   - Added route: `DELETE /bulk-delete-pages/` → BulkDeletePagesEndpoint

3. **apps/api/plane/app/views/__init__.py**
   - Exported `BulkArchivePagesEndpoint` and `BulkDeletePagesEndpoint`

### Frontend Service Layer (TypeScript)

4. **apps/web/core/services/page/project-page.service.ts**
   - Added `bulkArchive(workspaceSlug, projectId, pageIds)` method
   - Added `bulkDelete(workspaceSlug, projectId, pageIds)` method
   - Both methods properly handle API responses and errors

### State Management (MobX)

5. **apps/web/core/store/pages/project-page.store.ts**
   - Added `selectedPageIds: Set<string>` observable for tracking selections
   - Added `togglePageSelection(pageId)` action to toggle individual page selection
   - Added `selectAllPages(pageIds)` action to select all visible pages
   - Added `clearSelection()` action to clear all selections
   - Added `isPageSelected(pageId)` computed function to check selection state
   - Added `bulkArchivePages(pageIds)` action for bulk archiving
   - Added `bulkDeletePages(pageIds)` action for bulk deleting
   - Selection automatically clears when switching projects

### UI Components

6. **apps/web/core/components/pages/list/block.tsx**
   - Added optional checkbox for page selection
   - Added `enableSelection`, `isSelected`, `onToggleSelection` props
   - Checkbox click events properly stop propagation
   - Link navigation disabled when selection mode is active

7. **apps/web/core/components/pages/list/root.tsx**
   - Added `enableSelection` prop to toggle selection mode
   - Passes selection state and toggle handler to each PageListBlock
   - Connects to store for selection management

8. **apps/web/core/components/pages/list/bulk-action-toolbar.tsx** (NEW)
   - Fixed bottom toolbar showing selected count
   - Shows "Archive" button for active pages (Public/Private tabs)
   - Shows "Delete" button for archived pages
   - Cancel button to clear selection
   - Automatically handles bulk operations through store

9. **apps/web/core/components/pages/modals/bulk-delete-pages-modal.tsx** (NEW)
   - Confirmation modal for bulk delete operation
   - Shows count of pages to be deleted
   - Warning about permanent deletion
   - Displays success/error toast notifications
   - Properly cleans up state on close

10. **apps/web/core/components/pages/header/root.tsx**
    - Added "Select All" / "Deselect All" button when selection mode is enabled
    - Button only visible when `enableSelection` prop is true
    - Toggles between selecting all filtered pages and clearing selection

11. **apps/web/core/components/pages/pages-list-view.tsx**
    - Added `enableSelection` prop to control bulk action mode
    - Manages bulk delete modal state
    - Renders BulkActionToolbar when selection is enabled
    - Renders BulkDeletePagesModal for confirmation

12. **apps/web/app/(all)/[workspaceSlug]/(projects)/projects/(detail)/[projectId]/pages/(list)/page.tsx**
    - Enabled selection mode by passing `enableSelection={true}` to PagesListView and PagesListRoot

## Implementation Details

### Architecture

The implementation follows the existing patterns in the codebase:
- **Backend**: Uses Django REST Framework class-based views
- **Frontend Services**: Uses TypeScript service classes for API calls
- **State Management**: Uses MobX for reactive state management
- **UI Components**: Uses React with TypeScript and observer pattern

### Key Features

1. **Checkbox Selection**
   - Individual page checkboxes in list view
   - "Select All" / "Deselect All" button in header
   - Visual feedback for selected pages

2. **Bulk Archive (Active Pages)**
   - Available for Public and Private page tabs
   - Archives multiple pages and their descendants at once
   - Removes pages from favorites automatically
   - Updates UI without full page reload

3. **Bulk Delete (Archived Pages)**
   - Only available for Archived tab
   - Requires confirmation modal showing count
   - Only deletes pages that are already archived
   - Removes from favorites and recent visits
   - Handles child page orphaning

4. **Permission Handling**
   - Respects existing page permission model
   - Archive: Owner OR Admin/Member
   - Delete: Owner OR Admin only
   - Backend validates permissions per page

5. **User Experience**
   - Fixed bottom toolbar for bulk actions
   - Clear visual indicators for selection
   - Toast notifications for success/error
   - Automatic selection clearing after operations
   - Selection persists during filtering/sorting

### API Endpoints

#### Bulk Archive Pages
```
POST /api/workspaces/{slug}/projects/{project_id}/bulk-archive-pages/
Body: { "page_ids": ["uuid1", "uuid2", ...] }
Response: { "archived_at": "timestamp", "count": number }
```

#### Bulk Delete Pages
```
DELETE /api/workspaces/{slug}/projects/{project_id}/bulk-delete-pages/
Body: { "page_ids": ["uuid1", "uuid2", ...] }
Response: { "message": "N pages were deleted" }
```

## Testing Notes

### Manual Testing Checklist

1. **Selection UI**
   - [ ] Checkboxes appear next to each page
   - [ ] "Select All" button appears in header
   - [ ] Individual checkbox toggles selection
   - [ ] "Select All" selects all visible pages
   - [ ] "Deselect All" clears all selections

2. **Bulk Archive (Public/Private Tabs)**
   - [ ] Select multiple active pages
   - [ ] Click "Archive" in bottom toolbar
   - [ ] Pages move to Archived tab
   - [ ] Pages removed from favorites
   - [ ] Child pages also archived
   - [ ] Success toast appears
   - [ ] Selection clears after operation

3. **Bulk Delete (Archived Tab)**
   - [ ] Navigate to Archived tab
   - [ ] Select multiple archived pages
   - [ ] Click "Delete" in bottom toolbar
   - [ ] Confirmation modal appears with count
   - [ ] Click "Delete" in modal
   - [ ] Pages permanently deleted
   - [ ] Success toast appears
   - [ ] Selection clears after operation

4. **Error Handling**
   - [ ] Try archiving with no permissions (should fail gracefully)
   - [ ] Try deleting non-archived pages (should be prevented)
   - [ ] Network errors show error toast

5. **Edge Cases**
   - [ ] Select all, then filter - selection persists
   - [ ] Switch tabs - selection clears
   - [ ] Switch projects - selection clears
   - [ ] Cancel button clears selection

## Notes for Reviewers

1. **Permission Model**: The implementation maintains the existing permission structure. Archive requires owner OR admin/member role, while delete requires owner OR admin role.

2. **Child Pages**: When archiving a page, all descendant pages are automatically archived using the existing recursive SQL function `unarchive_archive_page_and_descendants`.

3. **UI Placement**: The bulk action toolbar is positioned at the bottom center of the screen (fixed position) to match common UI patterns and not interfere with the existing header.

4. **Selection State**: Selection is stored in a MobX observable Set for efficient lookups and reactive updates. It automatically clears when switching projects via a MobX reaction.

5. **Code Reuse**: The implementation reuses existing components (Button, ModalCore, ListItem) and follows the established patterns for issues bulk operations.

6. **TypeScript Safety**: All new code includes proper TypeScript types and interfaces to maintain type safety.

7. **Accessibility**: Checkboxes use semantic HTML with proper click event handling and stop propagation to prevent unintended navigation.
